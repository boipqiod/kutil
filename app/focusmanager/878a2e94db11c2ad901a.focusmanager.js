(()=>{"use strict";var t={95:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function r(t){try{c(s.next(t))}catch(t){o(t)}}function a(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;const n=i(205),o=i(520),r=i(713),a=i(789);class c{constructor(){if(this.originFocusTime=0,this.originRelaxTime=0,this.runningTime=0,this.isFocus=!0,this.startTime=0,this.isRunning=!1,this.init=()=>{(0,n.getById)("btn-start").addEventListener("click",this.startAction),(0,n.getById)("btn-end").addEventListener("click",this.end),(0,n.getById)("btn-relax-start").addEventListener("click",this.startRelax),(0,n.getById)("btn-focus-start").addEventListener("click",this.startFocus),(0,n.getById)("btn-info").addEventListener("click",this.showInfo),this.infoEle.addEventListener("click",this.closeInfo)},this.startAction=()=>{""===this.focusEle.value||""===this.relaxEle.value||Number(this.focusEle.value)<=0||Number(this.relaxEle.value)<=0?alert("입력 값을 확인해주세요"):this.start()},this.start=()=>{this.originFocusTime=this.runningTime=60*Number(this.focusEle.value),this.originRelaxTime=60*Number(this.relaxEle.value),this.updateTimeDisplay(this.runningTime),console.log("this.originFocusTime:",this.originFocusTime),console.log("this.originRelaxTime:",this.originRelaxTime),this.settingEle.classList.add("hide"),this.timerEle.classList.remove("hide"),this.startTime=Date.now(),this.isRunning=!0,this.timer=setInterval(this.timerAction,100),this.isFocus=!0,this.sendToServiceWorker("start")},this.end=()=>{this.timerEle.classList.add("hide"),this.settingEle.classList.remove("hide"),this.isFocus=!0,this.isRunning=!1,clearInterval(this.timer),this.sendToServiceWorker("end")},this.timerAction=()=>s(this,void 0,void 0,(function*(){var t;const e=(Date.now()-this.startTime)/1e3;if(this.runningTime-=e,this.updateTimeDisplay(this.runningTime),this.runningTime<=0){if(clearInterval(this.timer),this.sendToServiceWorker("start"),!this.isRunning)return;this.isRunning=!1,this.pushEle.checked&&o.default.showNotification(this.isFocus?"Focus Time is over! Good job":"Relax Time is over! Ready to focus",{body:"Click to start next session"}).then().catch(),(null===(t=this.soundEle)||void 0===t?void 0:t.checked)&&(yield new Audio(a.soundList.bell).play().catch((t=>console.log(t)))),this.autoEle.checked?this.isFocus?this.startRelax():this.startFocus():this.isFocus?(0,n.getById)("btn-relax-start").classList.remove("hide"):(0,n.getById)("btn-focus-start").classList.remove("hide")}})),this.startRelax=()=>{this.startTime=Date.now(),this.isFocus=!1,this.runningTime=this.originRelaxTime,(0,n.getById)("btn-relax-start").classList.add("hide"),(0,n.getById)("display-message").textContent="Relax",this.isRunning=!0,this.timer=setInterval(this.timerAction,100)},this.startFocus=()=>{this.startTime=Date.now(),this.isFocus=!0,this.runningTime=this.originFocusTime,(0,n.getById)("btn-focus-start").classList.add("hide"),(0,n.getById)("display-message").textContent="Focus",this.isRunning=!0,this.timer=setInterval(this.timerAction,100)},this.showInfo=()=>{this.infoEle.classList.remove("hide")},this.closeInfo=()=>{this.infoEle.classList.add("hide")},this.sendToServiceWorker=t=>{try{o.default.sendMessageToServiceWorker({appName:r.appServiceName.focusmanager,payload:t}).then()}catch(t){console.log(t)}},this.focusEle=(0,n.getById)("f_time"),this.relaxEle=(0,n.getById)("r_time"),this.autoEle=(0,n.getById)("auto"),this.pushEle=(0,n.getById)("push"),this.soundEle=(0,n.getById)("sound"),this.settingEle=(0,n.getById)("setting"),this.timerEle=(0,n.getById)("timer"),this.infoEle=(0,n.getById)("info"),c.shared)return c.shared;c.shared=this}updateTimeDisplay(t){const e=t<=0?0:t,i=Math.floor(e/60),s=Math.floor(e%60);(0,n.getById)("display-timer").textContent=`${String(i).padStart(2,"0")}:${String(s).padStart(2,"0")}`}}e.Controller=c},414:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function r(t){try{c(s.next(t))}catch(t){o(t)}}function a(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(95),o=i(316),r=i(520);window.onload=()=>s(void 0,void 0,void 0,(function*(){yield r.default.registerServiceWorker();try{yield(new Audio).play()}catch(t){document.getElementById("sound-label").remove()}try{const t=yield navigator.wakeLock.request("screen");console.log("wakeLock:",t)}catch(t){console.log(`${t.name}, ${t.message}`)}if(console.log("Notification.permission:",Notification.permission),"default"===Notification.permission){document.getElementById("subscribeButton").style.display="block",document.getElementById("subscribeButton").addEventListener("click",(()=>s(void 0,void 0,void 0,(function*(){yield Notification.requestPermission(),window.location.reload()}))))}(new n.Controller).init(),o.Indicator.instance.hideIndicator()}))},789:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.soundList=void 0;var i;!function(t){t.click="../../public/assets/sound/click.mp3",t.bell="../../public/assets/sound/bell.mp3"}(i||(e.soundList=i={}))},316:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Indicator=void 0;class i{static get instance(){return i._instance||(i._instance=new i),i._instance}constructor(){this.setIndicator=()=>{const t=document.createElement("div");t.id="indicator",t.classList.add("indicator"),document.body.appendChild(t)},this.hideIndicator=()=>{var t;null===(t=document.getElementById("indicator"))||void 0===t||t.remove()}}}e.Indicator=i},520:function(t,e){var i=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function r(t){try{c(s.next(t))}catch(t){o(t)}}function a(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static registerServiceWorker(){return i(this,void 0,void 0,(function*(){if("serviceWorker"in navigator){navigator.serviceWorker.addEventListener("message",(function(t){console.log("메인 스레드에서 받은 메시지:",t.data)}));const t=yield navigator.serviceWorker.getRegistration("../service-worker.js");t?(this.registration=t,console.log("Service Worker is already registered.")):yield navigator.serviceWorker.register("../service-worker.js")}else console.log("Service Worker is not supported by browser.")}))}static sendMessageToServiceWorker(t){var e,s;return i(this,void 0,void 0,(function*(){try{null===(s=null===(e=this.registration)||void 0===e?void 0:e.active)||void 0===s||s.postMessage(t)}catch(t){console.log(t)}}))}static showNotification(t,e){var s;return i(this,void 0,void 0,(function*(){yield null===(s=this.registration)||void 0===s?void 0:s.showNotification(t,e)}))}constructor(){}}},205:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getById=void 0;e.getById=t=>document.getElementById(t)},713:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.appServiceName=void 0,function(t){t.focusmanager="focusmanager"}(i||(e.appServiceName=i={}))}},e={};(function i(s){var n=e[s];if(void 0!==n)return n.exports;var o=e[s]={exports:{}};return t[s].call(o.exports,o,o.exports,i),o.exports})(414)})();