(()=>{"use strict";var e={95:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function r(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;const n=i(205),o=i(520),r=i(713),a=i(789);class c{constructor(){if(this.originFocusTime=0,this.originRelaxTime=0,this.runningTime=0,this.isFocus=!0,this.startTime=0,this.isRunning=!1,this.init=()=>{(0,n.getById)("btn-start").addEventListener("click",this.startAction),(0,n.getById)("btn-end").addEventListener("click",this.end),(0,n.getById)("btn-relax-start").addEventListener("click",(()=>{this.sendToServiceWorker("start")})),(0,n.getById)("btn-focus-start").addEventListener("click",(()=>{this.sendToServiceWorker("start")})),(0,n.getById)("btn-info").addEventListener("click",this.showInfo),this.pushEle.addEventListener("click",(()=>{"default"===Notification.permission&&(this.pushEle.checked=!1,alert('Please allow push notification\nClick button that right side of "Start" button'))})),this.infoEle.addEventListener("click",this.closeInfo)},this.startAction=()=>s(this,void 0,void 0,(function*(){""===this.focusEle.value||""===this.relaxEle.value||Number(this.focusEle.value)<=0||Number(this.relaxEle.value)<=0?alert("입력 값을 확인해주세요"):(yield o.default.sendMessageToServiceWorker({command:r.appServiceName.focusmanager,type:"init",payload:{isAuto:this.autoEle.checked,isPush:this.pushEle.checked,focusTime:60*Number(this.focusEle.value),relaxTime:60*Number(this.relaxEle.value)}}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",this.receiveFromServiceWorker),this.settingEle.classList.add("hide"),this.timerEle.classList.remove("hide"),this.sendToServiceWorker("start"))})),this.start=()=>{this.originFocusTime=this.runningTime=60*Number(this.focusEle.value),this.originRelaxTime=60*Number(this.relaxEle.value),this.startTime=Date.now(),this.isRunning=!0,this.timer=setInterval(this.timerAction,100),this.isFocus=!0,this.sendToServiceWorker("start")},this.end=()=>{navigator.serviceWorker.removeEventListener("message",this.receiveFromServiceWorker),this.timerEle.classList.add("hide"),this.settingEle.classList.remove("hide"),this.isFocus=!0,this.isRunning=!1,clearInterval(this.timer),this.sendToServiceWorker("end")},this.timerAction=()=>s(this,void 0,void 0,(function*(){})),this.setButton=e=>{(0,n.getById)("btn-focus-start").classList.remove("hide"),(0,n.getById)("btn-focus-start").textContent="focus"===e?"Focus":"Relax"},this.hideButton=()=>{(0,n.getById)("btn-focus-start").classList.add("hide")},this.showInfo=()=>{this.infoEle.classList.remove("hide")},this.closeInfo=()=>{this.infoEle.classList.add("hide")},this.sendToServiceWorker=e=>{try{o.default.sendMessageToServiceWorker({command:r.appServiceName.focusmanager,type:e,payload:null}).then()}catch(e){}},this.receiveFromServiceWorker=e=>{const t=e.data;if(t.command===r.appServiceName.focusmanager)switch(t.type){case"display":{const e=t.payload;this.isFocus=e.isFocus,this.runningTime=e.runningTime,this.updateTimeDisplay(this.runningTime,this.isFocus?"focus":"relax"),this.runningTime<=0?(new Audio(a.soundList.bell).play().catch((e=>{})),this.autoEle.checked?this.sendToServiceWorker("start"):this.setButton(this.isFocus?"relax":"focus")):this.hideButton();break}case"end":this.end()}},this.focusEle=(0,n.getById)("f_time"),this.relaxEle=(0,n.getById)("r_time"),this.autoEle=(0,n.getById)("auto"),this.pushEle=(0,n.getById)("push"),this.soundEle=(0,n.getById)("sound"),this.settingEle=(0,n.getById)("setting"),this.timerEle=(0,n.getById)("timer"),this.infoEle=(0,n.getById)("info"),c.shared)return c.shared;c.shared=this}updateTimeDisplay(e,t){const i=e<=0?0:e,s=Math.floor(i/60),o=Math.floor(i%60);(0,n.getById)("display-timer").textContent=`${String(s).padStart(2,"0")}:${String(o).padStart(2,"0")}`,(0,n.getById)("display-message").textContent="focus"===t?"Focus":"Relax"}}t.Controller=c},414:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function r(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(95),o=i(520),r=i(713),a=i(316);window.onload=()=>s(void 0,void 0,void 0,(function*(){a.Indicator.instance.setIndicator(),yield o.default.registerServiceWorker();try{yield navigator.wakeLock.request("screen")}catch(e){}if("default"===Notification.permission){document.getElementById("subscribeButton").style.display="block",document.getElementById("subscribeButton").addEventListener("click",(()=>s(void 0,void 0,void 0,(function*(){yield Notification.requestPermission(),window.location.reload()}))))}else if("denied"!==Notification.permission){document.getElementById("label-push").style.display="flex"}(new n.Controller).init(),a.Indicator.instance.hideIndicator()})),window.onbeforeunload=()=>{o.default.sendMessageToServiceWorker({command:r.appServiceName.focusmanager,type:"end",payload:""}).then().catch()}},789:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.soundList=void 0;var i;!function(e){e.click="../../public/assets/sound/click.mp3",e.bell="../../public/assets/sound/bell.mp3"}(i||(t.soundList=i={}))},316:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Indicator=void 0;class i{static get instance(){return i._instance||(i._instance=new i),i._instance}constructor(){this.setIndicator=()=>{const e=document.createElement("div");e.id="indicator",e.classList.add("indicator"),document.body.appendChild(e)},this.hideIndicator=()=>{var e;null===(e=document.getElementById("indicator"))||void 0===e||e.remove()}}}t.Indicator=i},520:function(e,t){var i=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function r(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{static registerServiceWorker(){return i(this,void 0,void 0,(function*(){if("serviceWorker"in navigator){const e=yield navigator.serviceWorker.getRegistration("../service-worker.js");e?this.registration=e:yield navigator.serviceWorker.register("../service-worker.js")}}))}static sendMessageToServiceWorker(e){var t,s;return i(this,void 0,void 0,(function*(){try{yield null===(s=null===(t=this.registration)||void 0===t?void 0:t.active)||void 0===s?void 0:s.postMessage(e)}catch(e){}}))}static showNotification(e,t){var s;return i(this,void 0,void 0,(function*(){yield null===(s=this.registration)||void 0===s?void 0:s.showNotification(e,t)}))}constructor(){}}},205:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getById=void 0;t.getById=e=>document.getElementById(e)},713:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.appServiceName=void 0,function(e){e.focusmanager="focusmanager"}(i||(t.appServiceName=i={}))}},t={};(function i(s){var n=t[s];if(void 0!==n)return n.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,i),o.exports})(414)})();